{
  "name": "TDD Next.js Development",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },
  
  "features": {
    "ghcr.io/devcontainers/features/common-utils:2": {},
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20",
      "nodeGypDependencies": true
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        // Core
        "editorconfig.editorconfig",
        "eamodio.gitlens",
        
        // JavaScript/TypeScript
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-vscode.vscode-typescript-next",
        
        // Testing
        "orta.vscode-jest",
        "ms-playwright.playwright",
        "kavod-io.vscode-jest-test-adapter",
        "hbenl.vscode-test-explorer",
        
        // AI Assistants for TDD
        "anthropic.claude-code",
        "google.geminicodeassist",
        
        // React
        "dsznajder.es7-react-js-snippets",
        "burkeholland.simple-react-snippets",
        
        // Coverage
        "ryanluker.vscode-coverage-gutters"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": true
        },
        "eslint.validate": [
          "javascript",
          "javascriptreact",
          "typescript",
          "typescriptreact"
        ],
        
        // Testing settings
        "jest.autoRun": {
          "watch": false,
          "onSave": "test-file"
        },
        "jest.showCoverageOnLoad": true,
        "coverage-gutters.showLineCoverage": true,
        "coverage-gutters.showRulerCoverage": true,
        
        // TDD workflow enforcement
        "files.exclude": {
          "**/coverage": false,
          "**/test-results": false
        },
        
        // Terminal settings for test output
        "terminal.integrated.scrollback": 10000,
        "terminal.integrated.enablePersistentSessions": true
      }
    }
  },

  "forwardPorts": [3000, 9229],
  
  "postCreateCommand": "npm install && npx playwright install && npx playwright install-deps",
  
  "postStartCommand": "npm run test:watch",
  
  "remoteUser": "node",
  
  "mounts": [
    "source=${localEnv:HOME}/.ssh,target=/home/node/.ssh,type=bind,readonly",
    "source=${localEnv:HOME}/.secrets,target=/home/node/.secrets,type=bind,readonly"
  ],
  
  "containerEnv": {
    "NODE_ENV": "development",
    "TDD_MODE": "strict",
    "TEST_RUNNER": "stagehand"
  },
  
  "hostRequirements": {
    "cpus": 2,
    "memory": "4gb",
    "storage": "10gb"
  }
}